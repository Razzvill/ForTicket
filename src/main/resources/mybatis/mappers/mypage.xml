<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.forTicket.mypage.dao.MypageDAO">	
	<resultMap id="memResult" type="MemberVO">
		<result property="mem_id" column="mem_id" />
		<result property="pwd" column="pwd" />
		<result property="mem_name" column="mem_name" />
		<result property="email" column="email" />
		<result property="phone" column="phone" />
		<result property="post" column="post" />
		<result property="addr1" column="addr1" />
		<result property="addr2" column="addr2" />
		<result property="b_number" column="b_number" />
		<result property="b_name" column="b_name" />
		<result property="b_phone" column="b_phone" />
		<result property="checkbox" column="checkbox" />
		<result property="type" column="type" />
		<result property="joinDate" column="joinDate" />
	</resultMap>		
	
	<resultMap id="orderResult" type="OrderVO">
		<result property="order_No" column="order_No" />
		<result property="goods_id" column="goods_id" />
		<result property="mem_id" column="mem_id" />
		<result property="s_no" column="s_no" />
		<result property="orderNum" column="orderNum" />
		<result property="ordersit" column="ordersit" />
		<result property="orderName" column="orderName" />
		<result property="orderPhone" column="orderPhone" />
		<result property="orderEmail" column="orderEmail" />
		<result property="orderPay" column="orderPay" />
		<result property="orderCheck" column="orderCheck" />
		<result property="orderStatus" column="orderStatus" />
		<result property="orderTicketing" column="orderTicketing" />
		<result property="orderDate" column="orderDate" />
		<result property="order_price" column="order_price" />
		<result property="goods_name" column="goods_name" />
	</resultMap>
	
	<!-- 예매 내역 페이지 -->
	<select id="myReservation" resultMap="orderResult"   parameterType="java.util.HashMap">
		select * from (
			select ROW_NUMBER() OVER (ORDER BY orderTicketing DESC) as recNum, table1.*
			from (
				select * 
				from `order` 
				where date_format(orderTicketing,'%Y-%m-%d') between #{beginDate} and #{endDate} 
				and mem_id=#{mem_id}
				<if test="search_type=='all' and search_type != null and search_type == null" >
		        	and (goods_name=#{search_word} OR orderDate=#{search_word} OR order_No=#{search_word})
				</if>
				<if test="search_type=='goods_name' and  search_type != null" >
		        	and goods_name=#{search_word}
				</if>
				<if test="search_type=='orderDate' and search_type != null">
		        	and orderDate=#{search_word}
				</if>
				<if test="search_type=='order_No' and search_type != null">
					and order_No=#{search_word}
				</if>
					order by orderTicketing desc
					 ) as table1
				) as table2				
			where				
		recNum between (#{section}-1)*100+ (#{pageNum}-1)*10+1 and (#{section}-1)*100+(#{pageNum})*10	      		    
	</select>
	
</mapper>
	