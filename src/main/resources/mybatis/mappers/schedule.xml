<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.forTicket.schedule.dao.ScheduleDAO">
	<resultMap id="scheduleResult" type="scheduleVO">
		<result property="s_no" column="s_no" />
		<result property="goods_id" column="goods_id" />
		<result property="theater_id" column="theater_id" />
		<result property="s_date" column="s_date" />
		<result property="seats" column="seats" />
		<result property="goods_name" column="goods_name" />
	</resultMap>
	
	<select id="selectSchedule" resultMap="scheduleResult" parameterType="java.util.Map">
		SELECT s.*,g.goods_name FROM schedule s, goods g
		WHERE s.goods_id = g.goods_id AND (theater_id=#{theater_id} AND date_format(s_date,'%Y-%m-%d %H:%i')=#{s_date})
	</select>
	
	<insert id="insertSchedule" parameterType="java.util.Map">
		INSERT INTO schedule(goods_id, theater_id, s_date, seats)
		VALUES(#{goods_id}, #{theater_id}, date_format(#{s_date},'%Y-%m-%d %H:%i'), #{seats})
	</insert>
	
	<delete id="deleteSchedule" parameterType="int">
		DELETE FROM schedule WHERE s_no=#{s_no}
	</delete>
	
	<update id="newOrder" parameterType="java.util.Map">
		UPDATE schedule
		SET seats=seats-#{seats} WHERE s_no=#{s_no}
	</update>
	
	<update id="cancelOrder" parameterType="java.util.Map">
		UPDATE schedule
		SET seats=seats+#{seats} WHERE s_no=#{s_no}
	</update>
</mapper>